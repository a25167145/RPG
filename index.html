<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‰¾æ‹‰å¥³ç‹èˆ‡æ‚²æ…Ÿä¹‹ç«çš„æ‚²æ­Œ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #2c2a3e;
            --panel-bg: #403e56;
            --border-color: #6a6784;
            --text-color: #e0ddeb;
            --highlight-color: #ffcc66;
            --danger-color: #ff6b6b;
            --success-color: #6bff9b;
            --buff-color: #82aaff;
            --ui-font: 'Noto Sans TC', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--ui-font);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
            box-sizing: border-box;
            user-select: none;
        }

        #game-container {
            width: 100%;
            max-width: 1000px;
            height: 600px;
            background-color: var(--panel-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: 1fr 150px;
            grid-template-areas:
                "sidebar main"
                "sidebar messages";
            gap: 15px;
            padding: 15px;
            box-sizing: border-box;
        }

        /* --- å´é‚Šæ¬„ --- */
        #sidebar {
            grid-area: sidebar;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar-panel {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }

        .sidebar-panel h3 {
            margin: 0 0 10px 0;
            color: var(--highlight-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            text-align: center;
        }
        
        #player-stats-panel ul, #equipment-panel ul, #inventory-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        #inventory-list .category-header {
            font-weight: bold;
            color: var(--highlight-color);
            margin-top: 10px;
            font-size: 0.8em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 4px;
        }
        #inventory-list li {
             display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            padding: 4px 0;
        }


        #player-stats-panel li, #equipment-panel li {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        #player-stats-panel .buffed {
            color: var(--buff-color);
            font-weight: bold;
        }
        #equipment-panel li span:first-child {
            color: #b0aec7;
        }


        /* --- ä¸»ç•«é¢ --- */
        #main-view {
            grid-area: main;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .view { display: none; }
        .view.active { display: block; }

        /* --- è¨Šæ¯æ—¥èªŒ --- */
        #message-log {
            grid-area: messages;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            font-size: 0.9em;
            line-height: 1.6;
        }
        #message-log p { margin: 0 0 5px 0; }
        .combat-msg { color: #ff9999; }
        .crit-msg { color: #ffc107; font-weight: bold; }
        .reward-msg { color: var(--success-color); }
        .story-msg { color: #aaddff; font-style: italic; }
        .buff-msg { color: var(--buff-color); }


        /* --- é€šç”¨æŒ‰éˆ•æ¨£å¼ --- */
        .game-button {
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-family: var(--ui-font);
            font-size: 1em;
            margin: 5px;
        }
        .game-button:hover { background-color: #5c5a74; }
        .game-button:active { transform: scale(0.98); }
        .game-button:disabled { background-color: #333; color: #777; cursor: not-allowed; }

        /* --- åœ°åœ–è¦–åœ– --- */
        #map-view h2 { text-align: center; color: var(--highlight-color); }
        #map-locations {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        .location-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .location-button {
            width: 150px;
            height: 60px;
            text-align: center;
        }
        .boss-button {
            width: 120px;
            height: 60px;
            background-color: var(--danger-color);
        }
        .boss-button:hover {
            background-color: #c14d4d;
        }

        /* --- å•†åº—è¦–åœ– --- */
        #shop-view { display: none; flex-direction: column; }
        #shop-view.active { display: flex; }
        #shop-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .shop-tab-button {
            background-color: #333;
        }
        .shop-tab-button.active {
            background-color: #5c5a74;
            border-color: var(--highlight-color);
        }
        #shop-content {
            flex-grow: 1;
            overflow-y: auto;
        }
        #shop-item-list {
            list-style: none;
            padding: 0;
        }
        .shop-item {
            display: grid;
            grid-template-columns: 1fr 1fr 80px;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        .shop-item:hover { background-color: rgba(255,255,255,0.05); }
        .item-info { font-size: 0.8em; color: #b0aec7; }

        /* --- æˆ°é¬¥è¦–åœ– --- */
        #combat-view { text-align: center; }
        #combat-turn-counter {
            color: var(--highlight-color);
            margin-bottom: 10px;
        }
        #combat-participants {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
        }
        .participant {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .participant-name { font-size: 1.2em; font-weight: bold; }
        .participant-hp { background: #222; padding: 2px 8px; border-radius: 5px; font-size: 0.9em; margin-top: 5px; }
        .hp-bar {
            width: 100px;
            height: 10px;
            background-color: var(--danger-color);
            border: 1px solid #111;
            border-radius: 5px;
            margin-top: 5px;
        }
        .hp-bar-inner {
            height: 100%;
            background-color: var(--success-color);
            border-radius: 4px;
        }
        .participant img {
            width: 128px; height: 128px;
            background: rgba(0,0,0,0.3);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            margin-top: 10px;
            object-fit: contain;
        }
        #combat-actions { margin-top: 20px; }
        
        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            body { padding: 5px; }
            #game-container {
                height: auto;
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 200px 150px;
                grid-template-areas:
                    "sidebar"
                    "main"
                    "messages";
            }
            #sidebar { flex-direction: row; flex-wrap: wrap; }
            .sidebar-panel { flex-grow: 1; }
        }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- ===== å´é‚Šæ¬„ ===== -->
        <aside id="sidebar">
            <div id="player-stats-panel" class="sidebar-panel">
                <h3>è‰¾æ‹‰å…¬ä¸»</h3>
                <ul>
                    <li><span>â¤ï¸ ç”Ÿå‘½å€¼</span> <span id="stat-hp"></span></li>
                    <li><span>âš”ï¸ æ”»æ“ŠåŠ›</span> <span id="stat-atk"></span></li>
                    <li><span>ğŸ›¡ï¸ é˜²ç¦¦åŠ›</span> <span id="stat-def"></span></li>
                    <li><span>ğŸ’° é‡‘å¹£</span> <span id="stat-gold"></span></li>
                </ul>
            </div>
            <div id="equipment-panel" class="sidebar-panel">
                <h3>è£å‚™</h3>
                <ul>
                    <li><span>æ­¦å™¨</span> <span id="equip-weapon"></span></li>
                    <li><span>è­·ç”²</span> <span id="equip-armor"></span></li>
                </ul>
            </div>
            <div id="inventory-panel" class="sidebar-panel">
                 <h3>é“å…·æ¬„</h3>
                 <ul id="inventory-list"></ul>
            </div>
        </aside>

        <!-- ===== ä¸»è¦–åœ– ===== -->
        <main id="main-view">
            <!-- æ•…äº‹/åŠ‡æƒ…è¦–åœ– -->
            <div id="story-view" class="view">
                <h2 id="story-title"></h2>
                <p id="story-text" style="white-space: pre-wrap; line-height: 1.8;"></p>
                <div id="story-options"></div>
            </div>

            <!-- åœ°åœ–è¦–åœ– -->
            <div id="map-view" class="view">
                <h2>ä¸–ç•Œåœ°åœ–</h2>
                <p style="text-align: center;">é¸æ“‡ä½ è¦å‰å¾€çš„åœ°é»ã€‚</p>
                <div id="map-locations"></div>
            </div>

            <!-- å•†åº—è¦–åœ– -->
            <div id="shop-view" class="view">
                <div id="shop-tabs">
                    <button class="game-button shop-tab-button active" onclick="game.changeShopTab(event, 'weapon')">æ­¦å™¨</button>
                    <button class="game-button shop-tab-button" onclick="game.changeShopTab(event, 'armor')">é˜²å…·</button>
                    <button class="game-button shop-tab-button" onclick="game.changeShopTab(event, 'item')">é“å…·</button>
                    <button class="game-button shop-tab-button" onclick="game.changeShopTab(event, 'sell')">å‡ºå”®</button>
                </div>
                <div id="shop-content">
                    <ul id="shop-item-list"></ul>
                </div>
                <div style="text-align: center; margin-top: auto;">
                    <button class="game-button" onclick="game.changeView('map-view')">é›¢é–‹å•†åº—</button>
                </div>
            </div>

            <!-- æˆ°é¬¥è¦–åœ– -->
            <div id="combat-view" class="view">
                <h3 id="combat-turn-counter"></h3>
                <div id="combat-participants">
                    <!-- ç©å®¶ -->
                    <div class="participant">
                        <div class="participant-name">è‰¾æ‹‰å…¬ä¸»</div>
                        <div class="participant-hp" id="combat-player-hp"></div>
                        <div class="hp-bar"><div class="hp-bar-inner" id="combat-player-hp-bar"></div></div>
                        <img src="https://placehold.co/128x128/e0ddeb/2c2a3e?text=è‰¾æ‹‰" alt="è‰¾æ‹‰å…¬ä¸»">
                    </div>
                    <!-- æ•µäºº -->
                    <div class="participant">
                        <div class="participant-name" id="combat-enemy-name"></div>
                        <div class="participant-hp" id="combat-enemy-hp"></div>
                        <div class="hp-bar"><div class="hp-bar-inner" id="combat-enemy-hp-bar"></div></div>
                        <img id="combat-enemy-img" src="" alt="æ•µäºº">
                    </div>
                </div>
                <div id="combat-actions"></div>
            </div>

        </main>

        <!-- ===== è¨Šæ¯æ—¥èªŒ ===== -->
        <div id="message-log"></div>
    </div>

<script>
// --- éŠæˆ²è³‡æ–™åº« ---
const ITEMS = {
    // æ­¦å™¨
    'w00': { name: 'ä¸€èˆ¬æœ¨å¼“', type: 'weapon', attack: 10, price: 0 },
    'w02': { name: 'çµæˆ¶é•·å¼“', type: 'weapon', attack: 20, price: 150 },
    'w03': { name: 'é‹¼è£½åå­—å¼“', type: 'weapon', attack: 35, price: 450 },
    'w04': { name: 'ç…é·²ä¹‹å–™', type: 'weapon', attack: 45, price: 1200 },
    'w01': { name: 'å†¬æœ¨ç²¾éˆä¹‹å¼“', type: 'weapon', attack: 60, price: 2500 },
    // è­·ç”²
    'a01': { name: 'å‹è£çš®ç”²', type: 'armor', defense: 10, price: 0 },
    'a02': { name: 'é–å­ç”²', type: 'armor', defense: 20, price: 120 },
    'a03': { name: 'é‹¼è£½èƒ¸ç”²', type: 'armor', defense: 30, price: 400 },
    'a04': { name: 'çš‡å®¶é¨å£«é§', type: 'armor', defense: 45, price: 1000 },
    // é“å…·
    'p01_low': { name: 'ä½ç´šæ¢å¾©è—¥æ°´', type: 'potion', effect: 'heal', value: 50, price: 30 },
    'p01_mid': { name: 'ä¸­ç´šæ¢å¾©è—¥æ°´', type: 'potion', effect: 'heal', value: 120, price: 70 },
    'p01_high': { name: 'é«˜ç´šæ¢å¾©è—¥æ°´', type: 'potion', effect: 'heal', value: 250, price: 150 },
    'p01_full': { name: 'è–å…‰è—¥æ°´', type: 'potion', effect: 'heal_full', value: 9999, price: 500 },
    'b01': { name: 'åŠ›é‡è—¥æ°´', type: 'potion', effect: 'buff_atk', value: 1.5, duration: 3, price: 80 },
    'b02': { name: 'æ´»åŠ›è—¥æ°´', type: 'potion', effect: 'buff_hp', value: 50, duration: 5, price: 100 },
    'u01': { name: 'ç”Ÿå‘½ä¹‹éœ²', type: 'upgrade', effect: 'perm_hp', value: 10, price: 400 },
    'u02': { name: 'ç”Ÿå‘½ä¹‹æ³‰', type: 'upgrade', effect: 'perm_hp', value: 25, price: 1000 },
    'p02': { name: 'éœå¿ƒè‰', type: 'quest', description: 'æ£®æ—éš±å£«è´ˆèˆ‡çš„è—¥è‰ï¼Œä¼¼ä¹èƒ½è®“äººä¿æŒé ­è…¦æ¸…æ™°ã€‚' },
    // ç´ æ
    'm01': { name: 'è¿·éœ§æ ¸å¿ƒ', type: 'material', price: 12 },
    'm02': { name: 'ç´”æ·¨ç²¾è¯', type: 'material', price: 50 },
    'm03': { name: 'èœ˜è››çµ²', type: 'material', price: 8 },
    'm04': { name: 'åŠ‡æ¯’æ¯’å›Š', type: 'material', price: 45 },
    'm05': { name: 'ç…é·²çš„ç¾½æ¯›', type: 'material', price: 30 },
    'm06': { name: 'é¢¨ä¹‹çµæ™¶', type: 'material', price: 120 },
    'm07': { name: 'ç†”å²©ç¢å¡Š', type: 'material', price: 40 },
    'm08': { name: 'ç«ç„°ä¹‹å¿ƒ', type: 'material', price: 180 }
};

const ENEMIES = {
    // ä¸€èˆ¬æ€ªç‰©
    'mist_spirit': { name: 'è¿·éœ§ç²¾æ€ª', hp: 50, attack: 12, defense: 4, gold: 20, img: 'https://placehold.co/128x128/a3b1c6/e0ddeb?text=ç²¾æ€ª', drops: { common: { id: 'm01', chance: 0.7 }, rare: { id: 'm02', chance: 0.15 } } },
    'poison_spider': { name: 'åŠ‡æ¯’èœ˜è››', hp: 70, attack: 18, defense: 6, gold: 35, img: 'https://placehold.co/128x128/4b5320/e0ddeb?text=èœ˜è››', drops: { common: { id: 'm03', chance: 0.8 }, rare: { id: 'm04', chance: 0.2 } } },
    'lava_troll': { name: 'ç†”å²©å·¨é­”', hp: 200, attack: 35, defense: 18, gold: 150, img: 'https://placehold.co/128x128/8b0000/e0ddeb?text=å·¨é­”', drops: { common: { id: 'm07', chance: 0.9 }, rare: { id: 'm08', chance: 0.25 } } },
    // å€åŸŸé ­ç›®
    'forest_guardian': { name: 'é å¤æ¨¹ç²¾', hp: 250, attack: 22, defense: 10, gold: 200, isBoss: true, img: 'https://placehold.co/128x128/556b2f/e0ddeb?text=æ¨¹ç²¾', drops: { common: { id: 'm02', chance: 1.0 }, rare: { id: 'u01', chance: 1.0 } } },
    'griffin': { name: 'å…‡çŒ›çš„ç…é·²', hp: 350, attack: 32, defense: 15, gold: 300, isBoss: true, img: 'https://placehold.co/128x128/d4a017/e0ddeb?text=ç…é·²', drops: { common: { id: 'm06', chance: 1.0 }, rare: { id: 'u01', chance: 1.0 } } },
    'wasteland_tyrant': { name: 'ç‡¼ç«æš´å›', hp: 500, attack: 42, defense: 20, gold: 500, isBoss: true, img: 'https://placehold.co/128x128/b22222/e0ddeb?text=æš´å›', drops: { common: { id: 'm08', chance: 1.0 }, rare: { id: 'u02', chance: 1.0 } } },
    // æœ€çµ‚é ­ç›®
    'boss': { name: 'å‡±è˜­çˆµå£«', hp: 800, attack: 50, defense: 25, gold: 0, isBoss: true, img: 'https://placehold.co/128x128/ffd54f/2c2a3e?text=å‡±è˜­' }
};

const LOCATIONS = {
    'city': { name: 'è‰¾åˆ©å¤šçˆ¾ç‹åŸ', encounters: [], actions: ['shop'], unlockCondition: () => true },
    'forest': { name: 'ä½èªæ£®æ—', encounters: ['mist_spirit', 'poison_spider'], boss: 'forest_guardian', unlockCondition: () => game.storyProgress >= 's1_journey_start' },
    'mountains': { name: 'é¢¨è•å±±è„ˆ', encounters: [], boss: 'griffin', unlockCondition: () => game.storyProgress >= 's4_mountain_unlocked' },
    'wasteland': { name: 'ç‡¼ç«ä¹‹åœ°', encounters: ['lava_troll'], boss: 'wasteland_tyrant', unlockCondition: () => game.storyProgress >= 's5_wasteland_unlocked' },
    'peak': { name: 'ç‡¼ç«ä¹‹å·”', encounters: [], boss: 'boss', unlockCondition: () => game.storyProgress >= 's6_peak_unlocked' }
};

const STORY = {
    's0_start': {
        title: 'ç¬¬ä¸€ç« ï¼šå…¬ä¸»çš„æ±ºå¿ƒ',
        text: `ç‹åœ‹æœ€å¼·çš„é¨å£«å‡±è˜­è¢«ä¿˜ï¼Œç„¡äººæ•¢å»ç‡Ÿæ•‘ã€‚\nå¦³ï¼Œè‰¾æ‹‰å…¬ä¸»ï¼Œæ±ºå®šè¦ªè‡ªè¸ä¸Šå¾é€”ã€‚\nã€Œå¦‚æœç‹åœ‹æœ€å¼·çš„åŠéƒ½å·²å±ˆæœï¼Œé‚£é€™å°±ä¸å†åªæ˜¯æŸå€‹é¨å£«çš„æˆ°çˆ­ï¼Œè€Œæ˜¯æ•´å€‹ç‹åœ‹çš„ã€‚ã€`,
        options: [{ text: 'æ·±å¤œï¼Œç¨è‡ªé›¢é–‹ç‹åŸ', action: () => game.advanceStory('s1_journey_start') }]
    },
    's1_journey_start': {
        title: 'å•Ÿç¨‹',
        text: `å¦³æ›ä¸Šå‹è£ï¼Œæ‚„æ‚„åœ°é›¢é–‹äº†ç‹åŸã€‚\nå¦³çš„ç¬¬ä¸€ç«™ï¼Œæ˜¯è¢«æ¿ƒéœ§ç± ç½©çš„ã€Œä½èªæ£®æ—ã€ã€‚`,
        options: [{ text: 'æŸ¥çœ‹åœ°åœ–', action: () => game.changeView('map-view') }]
    },
    's2_forest_hermit': {
        title: 'ç¬¬äºŒç« ï¼šä½èªæ£®æ—çš„è¿·éœ§',
        text: `åœ¨æ£®æ—æ·±è™•çš„æ²¼æ¾¤åœ°ï¼Œå¦³é‡åˆ°äº†ä¸€ä½ç¥ç§˜çš„è‰è—¥å¸«ã€‚å¥¹è´ˆèˆ‡å¦³ä¸€åŒ…ã€Œéœå¿ƒè‰ã€ã€‚\nã€Œå­©å­ï¼Œè¨˜ä½ï¼Œçœ¼ç›çœ‹åˆ°çš„å…‰èŠ’ï¼Œæœ‰æ™‚æ¯”æœ€æ·±çš„é»‘æš—æ›´å…·æ¬ºé¨™æ€§ã€‚ç”¨å¿ƒå»æ„Ÿå—ï¼Œè€Œéç”¨çœ¼å»åˆ¤æ–·ã€‚ã€`,
        options: [{ 
            text: 'æ”¶ä¸‹è—¥è‰ï¼Œç¹¼çºŒæ¢ç´¢æ£®æ—', 
            action: () => {
                game.storyProgress = 's3_forest_hermit_met';
                game.player.inventory['p02'] = (game.player.inventory['p02'] || 0) + 1;
                game.renderInventory();
                game.logMessage('ä½ ç²å¾—äº†ã€Œéœå¿ƒè‰ã€ã€‚', 'reward-msg');
                game.logMessage('å¦³å°‡è‰è—¥å¸«çš„è©±éŠ˜è¨˜åœ¨å¿ƒï¼Œç¹¼çºŒåœ¨ä½èªæ£®æ—ä¸­æ¢ç´¢ã€‚', 'story-msg');
                game.renderMap();
                game.changeView('map-view');
            }
        }]
    },
    's4_mountain_unlocked': {
        title: 'å‰å¾€å±±è„ˆ',
        text: 'å¦³æ“Šæ•—äº†æ£®æ—çš„å®ˆè­·è€…ï¼Œéšªå³»çš„é¢¨è•å±±è„ˆè³ç«‹åœ¨çœ¼å‰ã€‚é“è·¯è®Šå¾—æ›´åŠ è‰±éšªã€‚',
        options: [{ text: 'æŸ¥çœ‹åœ°åœ–', action: () => game.changeView('map-view') }]
    },
    's5_wasteland_unlocked': {
        title: 'ç¬¬å››ç« ï¼šç‡¼ç«ä¹‹åœ°çš„è­¦å‘Š',
        text: 'æ“Šæ•—ç…é·²å¾Œï¼Œå¦³ç¿»è¶Šäº†å±±è„ˆã€‚ä¸€ç‰‡ç„¦é»‘çš„è’åœŸå‡ºç¾åœ¨çœ¼å‰ï¼Œç©ºæ°£ä¸­ç€°æ¼«è‘—ç¡«ç£ºçš„æ°£å‘³èˆ‡ä¸€è‚¡æ·±æ²‰çš„å“€å‚·ã€‚',
        options: [{ text: 'æŸ¥çœ‹åœ°åœ–', action: () => game.changeView('map-view') }]
    },
    's6_peak_unlocked': {
         title: 'å‰å¾€é¾ç©´',
         text: 'å¦³ç©¿è¶Šäº†å±éšªçš„ç‡¼ç«ä¹‹åœ°ï¼Œçµ‚æ–¼æŠµé”äº†ç‡¼ç«ä¹‹å·”ã€‚å·¨å¤§çš„é¾ç©´å…¥å£å°±åœ¨çœ¼å‰ï¼Œç†¾ç†±çš„ç©ºæ°£è¿é¢æ’²ä¾†ã€‚',
         options: [{ text: 'ä½¿ç”¨ã€Œéœå¿ƒè‰ã€å¾Œé€²å…¥', action: () => game.advanceStory('s7_final_confrontation') }]
    },
    's7_final_confrontation': {
        title: 'ç¬¬å…­ç« ï¼šè™›å½çš„è‹±é›„',
        text: `åœ¨é¾ç©´æ·±è™•ï¼Œå¦³çœ‹åˆ°äº†å®‰ç„¶ç„¡æ™çš„å‡±è˜­ï¼Œä»¥åŠåœ¨ä»–å°é¢å—šå’½çš„å·¨é¾ä¼Šæ ¼å¨œã€‚å·¢ç©´ä¸­ï¼Œç ´ç¢çš„é¾è›‹æ­ç¤ºäº†æ®˜é…·çš„çœŸç›¸ã€‚\nã€Œæˆ‘ç•¶è‘—ç‰ çš„é¢ï¼Œè¦ªæ‰‹æ¯€äº†ç‰ çš„å¸Œæœ›ï¼ã€å‡±è˜­ç‹‚ç¬‘è‘—ï¼Œã€Œæ­·å²æ˜¯ç”±å‹åˆ©è€…æ›¸å¯«çš„ï¼ã€`,
        options: [{ text: 'èˆ‰èµ·å¼“ï¼Œå°æº–çœŸæ­£çš„æ€ªç‰©', action: () => game.startCombat('boss', true) }]
    },
    's8_ending': {
        title: 'çµ‚ç« ï¼šå¥³ç‹èˆ‡å·¨é¾çš„æ‚²æ­Œ',
        text: `å¦³æ“Šæ•—äº†å¢®è½çš„è‹±é›„ï¼Œå¸¶å›äº†çœŸç›¸ã€‚æ•¸å¹´å¾Œï¼Œå¦³åŠ å†•ç‚ºç‹ï¼Œè¢«å°Šç¨±ç‚ºã€ŒçœŸç†å¥³ç‹ã€è‰¾æ‹‰ã€‚\nä¸€å€‹æ–°çš„å‚³èªªé–‹å§‹æµå‚³ï¼Œé—œæ–¼ä¸€ä½å¥³ç‹ï¼Œä¸€é ­å·¨é¾ï¼Œå’Œä¸€ä»½ç”¨çœŸç›¸èˆ‡é®®è¡€é‘„å°±çš„ã€æ²‰é‡çš„ç¾ˆçµ†ã€‚\n\nã€çœŸå¯¦çµå±€ã€‘`,
        options: [{ text: 'é‡æ–°é–‹å§‹éŠæˆ²', action: () => game.init() }]
    }
};


// --- éŠæˆ²ä¸»é‚è¼¯ ---
const game = {
    player: {},
    currentView: 'story-view',
    combatState: {},
    currentShopTab: 'weapon',

    init() {
        this.player = {
            maxHp: 100,
            hp: 100,
            attack: 10,
            defense: 10,
            gold: 50,
            equipment: {
                weapon: 'w00',
                armor: 'a01'
            },
            inventory: { 'p01_low': 2 },
            defeatedBosses: []
        };
        this.storyProgress = 's0_start';
        this.updatePlayerStats();
        this.renderInventory();
        this.renderMap();
        this.logMessage("æ­¡è¿ä¾†åˆ°ã€Šè‰¾æ‹‰å¥³ç‹èˆ‡æ‚²æ…Ÿä¹‹ç«çš„æ‚²æ­Œã€‹", "story-msg");
        this.advanceStory('s0_start');
    },

    updatePlayerStats() {
        const weapon = ITEMS[this.player.equipment.weapon];
        const armor = ITEMS[this.player.equipment.armor];
        this.player.attack = weapon.attack;
        this.player.defense = armor.defense;

        const statAtkSpan = document.getElementById('stat-atk');
        const statHpSpan = document.getElementById('stat-hp');
        
        statHpSpan.textContent = `${this.player.hp} / ${this.player.maxHp}`;
        statAtkSpan.textContent = this.player.attack;
        statAtkSpan.classList.remove('buffed');

        document.getElementById('stat-def').textContent = this.player.defense;
        document.getElementById('stat-gold').textContent = this.player.gold;
        document.getElementById('equip-weapon').textContent = weapon.name;
        document.getElementById('equip-armor').textContent = armor.name;
    },

    renderInventory() {
        const list = document.getElementById('inventory-list');
        list.innerHTML = '';
        
        const categories = {
            potion: 'é“å…·',
            upgrade: 'å¼·åŒ–ç‰©å“',
            material: 'ç´ æ',
            quest: 'ä»»å‹™ç‰©å“'
        };

        const groupedInventory = {};
        for (const itemId in this.player.inventory) {
            if (this.player.inventory[itemId] > 0) {
                const item = ITEMS[itemId];
                if (!groupedInventory[item.type]) {
                    groupedInventory[item.type] = [];
                }
                groupedInventory[item.type].push({ ...item, id: itemId, count: this.player.inventory[itemId] });
            }
        }

        for (const type in categories) {
            if (groupedInventory[type] && groupedInventory[type].length > 0) {
                const header = document.createElement('li');
                header.className = 'category-header';
                header.textContent = categories[type];
                list.appendChild(header);

                groupedInventory[type].forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${item.name}</span> <span>x${item.count}</span>`;
                    list.appendChild(li);
                });
            }
        }
    },

    renderMap() {
        const container = document.getElementById('map-locations');
        container.innerHTML = '';
        for (const locId in LOCATIONS) {
            const loc = LOCATIONS[locId];
            if (loc.unlockCondition()) {
                const div = document.createElement('div');
                div.className = 'location-container';
                
                const button = document.createElement('button');
                button.className = 'game-button location-button';
                
                if (locId === 'city') {
                    button.innerHTML = `${loc.name}<br><span style="font-size:0.8em; color: var(--highlight-color);">[å•†åº—]</span>`;
                } else {
                    button.textContent = loc.name;
                }
                
                button.onclick = () => this.travel(locId);
                div.appendChild(button);

                if (loc.boss && !this.player.defeatedBosses.includes(loc.boss) && loc.boss !== 'boss') {
                     const bossButton = document.createElement('button');
                     bossButton.className = 'game-button boss-button';
                     bossButton.textContent = 'æŒ‘æˆ°é ­ç›®';
                     bossButton.onclick = () => this.startCombat(loc.boss, true);
                     div.appendChild(bossButton);
                }
                container.appendChild(div);
            }
        }
    },

    changeShopTab(event, tabName) {
        this.currentShopTab = tabName;
        document.querySelectorAll('.shop-tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
        this.renderShopContent();
    },

    renderShopContent() {
        const list = document.getElementById('shop-item-list');
        list.innerHTML = '';

        if (this.currentShopTab === 'sell') {
            let hasMaterials = false;
            for (const itemId in this.player.inventory) {
                const count = this.player.inventory[itemId];
                if (count > 0 && ITEMS[itemId].type === 'material') {
                    hasMaterials = true;
                    const item = ITEMS[itemId];
                    const li = document.createElement('li');
                    li.className = 'shop-item';
                    li.innerHTML = `
                        <div>
                            <strong>${item.name} (x${count})</strong>
                            <div class="item-info">å¯å‡ºå”®</div>
                        </div>
                        <div style="color: var(--success-color);">ğŸ’° ${item.price}</div>
                        <button class="game-button" onclick="game.sellItem('${itemId}')">å‡ºå”®</button>
                    `;
                    list.appendChild(li);
                }
            }
            if (!hasMaterials) {
                list.innerHTML = `<li style="text-align:center; color: var(--border-color); padding: 20px;">ä½ æ²’æœ‰ä»»ä½•å¯å‡ºå”®çš„ç´ æã€‚</li>`;
            }
        } else {
            for (const itemId in ITEMS) {
                const item = ITEMS[itemId];
                let show = false;
                if (this.currentShopTab === 'weapon' && item.type === 'weapon') show = true;
                if (this.currentShopTab === 'armor' && item.type === 'armor') show = true;
                if (this.currentShopTab === 'item' && (item.type === 'potion' || item.type === 'upgrade')) show = true;

                if (show && item.price > 0) {
                    const li = document.createElement('li');
                    li.className = 'shop-item';
                    let statsText = '';
                    if (item.type === 'weapon') statsText = `æ”»æ“Š +${item.attack}`;
                    else if (item.type === 'armor') statsText = `é˜²ç¦¦ +${item.defense}`;
                    else if (item.effect === 'heal') statsText = `æ¢å¾© ${item.value} HP`;
                    else if (item.effect === 'heal_full') statsText = `æ¢å¾©æ‰€æœ‰ HP`;
                    else if (item.effect === 'buff_atk') statsText = `æ”»æ“Š x${item.value} (${item.duration}å›åˆ)`;
                    else if (item.effect === 'buff_hp') statsText = `ç”Ÿå‘½ä¸Šé™+${item.value} (${item.duration}å›åˆ)`;
                    else if (item.effect === 'perm_hp') statsText = `æ°¸ä¹…ç”Ÿå‘½ä¸Šé™ +${item.value}`;

                    li.innerHTML = `
                        <div>
                            <strong>${item.name}</strong>
                            <div class="item-info">${statsText}</div>
                        </div>
                        <div style="color: var(--highlight-color);">ğŸ’° ${item.price}</div>
                        <button class="game-button" onclick="game.buyItem('${itemId}')">è³¼è²·</button>
                    `;
                    list.appendChild(li);
                }
            }
        }
    },

    logMessage(text, className = '') {
        const log = document.getElementById('message-log');
        const p = document.createElement('p');
        p.textContent = text;
        if (className) p.className = className;
        log.prepend(p);
    },

    changeView(viewId) {
        // If leaving the shop, clear its content to prevent visual bugs
        if (this.currentView === 'shop-view' && viewId !== 'shop-view') {
            document.getElementById('shop-item-list').innerHTML = '';
        }

        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        this.currentView = viewId;
        
        if (viewId === 'shop-view') {
            const firstTab = document.querySelector('.shop-tab-button');
            if (firstTab) {
                this.changeShopTab({currentTarget: firstTab}, 'weapon');
            }
        }
    },
    
    advanceStory(storyKey) {
        this.storyProgress = storyKey;
        const storyPart = STORY[storyKey];
        if(!storyPart) return;
        
        if (storyKey === 's7_final_confrontation') {
             if (this.player.inventory['p02'] > 0) {
                this.player.inventory['p02']--;
                this.renderInventory();
                this.logMessage('ä½ ä½¿ç”¨äº†ã€Œéœå¿ƒè‰ã€ï¼Œæ··äº‚çš„æ€ç·’ç‚ºä¹‹ä¸€æ¸…ã€‚');
             }
        }

        this.renderMap();
        document.getElementById('story-title').textContent = storyPart.title;
        document.getElementById('story-text').textContent = storyPart.text;
        
        const optionsContainer = document.getElementById('story-options');
        optionsContainer.innerHTML = '';
        storyPart.options.forEach(opt => {
            const button = document.createElement('button');
            button.className = 'game-button';
            button.textContent = opt.text;
            button.onclick = opt.action;
            optionsContainer.appendChild(button);
        });
        this.changeView('story-view');
    },

    travel(locId) {
        const loc = LOCATIONS[locId];
        this.logMessage(`ä½ ä¾†åˆ°äº† ${loc.name}ã€‚`);
        
        if(locId === 'forest' && this.storyProgress === 's1_journey_start') {
            this.advanceStory('s2_forest_hermit');
            return;
        }

        if (loc.actions && loc.actions.includes('shop')) {
            this.changeView('shop-view');
            return;
        }

        if (loc.encounters.length > 0) {
            if (Math.random() < 0.8) {
                const enemyId = loc.encounters[Math.floor(Math.random() * loc.encounters.length)];
                this.startCombat(enemyId);
            } else {
                this.logMessage('é€™è£¡ä¼¼ä¹å¾ˆå¹³éœ...');
                this.changeView('map-view');
            }
        } else {
             this.changeView('map-view');
        }
    },
    
    buyItem(itemId) {
        const item = ITEMS[itemId];
        if(this.player.gold >= item.price) {
            this.player.gold -= item.price;
            if(item.type === 'potion' || item.type === 'upgrade') {
                this.player.inventory[itemId] = (this.player.inventory[itemId] || 0) + 1;
                
                if(item.effect === 'perm_hp') {
                    this.usePermanentUpgrade(itemId);
                }
            } else { 
                const oldItemId = this.player.equipment[item.type];
                if (ITEMS[oldItemId].price !== 0) {
                    this.player.inventory[oldItemId] = (this.player.inventory[oldItemId] || 0) + 1;
                }
                this.player.equipment[item.type] = itemId;
            }
            this.logMessage(`ä½ è³¼è²·äº† ${item.name}ã€‚`, 'reward-msg');
            this.updatePlayerStats();
            this.renderInventory();
        } else {
            this.logMessage('ä½ çš„é‡‘å¹£ä¸å¤ ï¼');
        }
    },
    
    usePermanentUpgrade(itemId) {
        const item = ITEMS[itemId];
        if (this.player.inventory[itemId] > 0) {
            if (item.effect === 'perm_hp') {
                this.player.maxHp += item.value;
                this.player.hp += item.value; 
                this.logMessage(`ä½ çš„ç”Ÿå‘½ä¸Šé™æ°¸ä¹…æå‡äº† ${item.value}ï¼`, 'reward-msg');
            }
            this.player.inventory[itemId]--;
            this.updatePlayerStats();
            this.renderInventory();
        }
    },


    sellItem(itemId) {
        if (this.player.inventory[itemId] > 0) {
            const item = ITEMS[itemId];
            this.player.inventory[itemId]--;
            this.player.gold += item.price;
            this.logMessage(`ä½ è³£æ‰äº† ${item.name}ï¼Œç²å¾—äº† ${item.price} é‡‘å¹£ã€‚`, 'reward-msg');
            this.updatePlayerStats();
            this.renderInventory();
            this.changeShopTab({currentTarget: document.querySelector('.shop-tab-button.active')}, 'sell');
        }
    },

    startCombat(enemyId, isStoryBoss = false) {
        const enemy = { ...ENEMIES[enemyId] }; 
        this.combatState = {
            isStoryBoss,
            enemyId,
            turnCount: 1,
            player: {
                hp: this.player.hp,
                maxHp: this.player.maxHp,
                attack: this.player.attack,
                defense: this.player.defense,
                buffs: {}
            },
            enemy: { ...enemy, maxHp: enemy.hp },
            turn: 'player'
        };

        this.logMessage(`ä½ é­é‡äº† ${enemy.name}ï¼`, 'combat-msg');
        this.startPlayerTurn();
        this.changeView('combat-view');
    },

    renderCombatUI() {
        const { player, enemy, turnCount } = this.combatState;
        
        document.getElementById('combat-turn-counter').textContent = `ç¬¬ ${turnCount} å›åˆ`;
        document.getElementById('combat-enemy-name').textContent = enemy.name;
        document.getElementById('combat-enemy-img').src = enemy.img;
        document.getElementById('combat-player-hp').textContent = `HP: ${player.hp} / ${player.maxHp}`;
        document.getElementById('combat-enemy-hp').textContent = `HP: ${enemy.hp} / ${enemy.maxHp}`;
        document.getElementById('combat-player-hp-bar').style.width = `${Math.max(0, player.hp / player.maxHp * 100)}%`;
        document.getElementById('combat-enemy-hp-bar').style.width = `${Math.max(0, enemy.hp / enemy.maxHp * 100)}%`;
        
        const statAtkSpan = document.getElementById('stat-atk');
        let currentAtk = this.player.attack;
        if(player.buffs.attack) {
            currentAtk = Math.floor(currentAtk * player.buffs.attack.multiplier);
            statAtkSpan.textContent = `${currentAtk} (${this.player.attack})`;
            statAtkSpan.classList.add('buffed');
        } else {
            statAtkSpan.textContent = this.player.attack;
            statAtkSpan.classList.remove('buffed');
        }

        const statHpSpan = document.getElementById('stat-hp');
        statHpSpan.textContent = `${this.player.hp} / ${this.player.maxHp}`;
        statHpSpan.classList.remove('buffed');
        if (player.buffs.hp) {
             statHpSpan.classList.add('buffed');
        }


        const actionsContainer = document.getElementById('combat-actions');
        actionsContainer.innerHTML = '';
        if (this.combatState.turn === 'player') {
            const attackBtn = document.createElement('button');
            attackBtn.className = 'game-button';
            attackBtn.textContent = 'æ”»æ“Š';
            attackBtn.onclick = () => this.combatAction('attack');
            actionsContainer.appendChild(attackBtn);

            for(const itemId in this.player.inventory) {
                if(ITEMS[itemId].type === 'potion' && this.player.inventory[itemId] > 0) {
                     const itemBtn = document.createElement('button');
                     itemBtn.className = 'game-button';
                     itemBtn.textContent = `${ITEMS[itemId].name} (x${this.player.inventory[itemId]})`;
                     itemBtn.onclick = () => this.combatAction('use_item', itemId);
                     actionsContainer.appendChild(itemBtn);
                }
            }
            
            const fleeBtn = document.createElement('button');
            fleeBtn.className = 'game-button';
            fleeBtn.textContent = 'é€ƒè·‘';
            fleeBtn.onclick = () => this.combatAction('flee');
            if (this.combatState.isStoryBoss) {
                fleeBtn.disabled = true;
            }
            actionsContainer.appendChild(fleeBtn);
        }
    },
    
    startPlayerTurn() {
        const { buffs } = this.combatState.player;
        for (const buffKey in buffs) {
            buffs[buffKey].duration--;
            if (buffs[buffKey].duration <= 0) {
                if (buffKey === 'attack') this.logMessage(`åŠ›é‡è—¥æ°´çš„æ•ˆæœæ¶ˆå¤±äº†ã€‚`, 'buff-msg');
                if (buffKey === 'hp') {
                    this.logMessage(`æ´»åŠ›è—¥æ°´çš„æ•ˆæœæ¶ˆå¤±äº†ã€‚`, 'buff-msg');
                    this.combatState.player.maxHp -= buffs[buffKey].value;
                    this.combatState.player.hp = Math.min(this.combatState.player.hp, this.combatState.player.maxHp);
                }
                delete buffs[buffKey];
            }
        }
        this.combatState.turn = 'player';
        this.renderCombatUI();
    },

    endPlayerTurn() {
        if (this.combatState.enemy.hp <= 0) {
            this.endCombat(true);
            return;
        }
        this.combatState.turn = 'enemy';
        this.renderCombatUI();
        setTimeout(() => this.enemyTurn(), 1000);
    },

    combatAction(type, payload) {
        if(this.combatState.turn !== 'player') return;
        const { player, enemy } = this.combatState;

        if(type === 'attack') {
            let baseAttack = this.player.attack;
            if (player.buffs.attack) {
                baseAttack = Math.floor(baseAttack * player.buffs.attack.multiplier);
            }
            let damage = Math.max(1, baseAttack - enemy.defense);
            
            if (Math.random() < 0.3) {
                damage = Math.floor(damage * 1.5);
                this.logMessage(`æš´æ“Šï¼ä½ å° ${enemy.name} é€ æˆäº† ${damage} é»å‚·å®³ï¼`, 'crit-msg');
            } else {
                this.logMessage(`ä½ å° ${enemy.name} é€ æˆäº† ${damage} é»å‚·å®³ã€‚`, 'combat-msg');
            }
            enemy.hp = Math.max(0, enemy.hp - damage);

        } else if (type === 'use_item') {
            const item = ITEMS[payload];
            if(this.player.inventory[payload] > 0) {
                this.player.inventory[payload]--;
                if (item.effect === 'heal') {
                    const healed = item.value;
                    player.hp = Math.min(player.maxHp, player.hp + healed);
                    this.logMessage(`ä½ ä½¿ç”¨äº† ${item.name}ï¼Œæ¢å¾©äº† ${healed} HPã€‚`, 'reward-msg');
                } else if (item.effect === 'heal_full') {
                    player.hp = player.maxHp;
                    this.logMessage(`ä½ ä½¿ç”¨äº† ${item.name}ï¼Œç”Ÿå‘½å€¼å®Œå…¨æ¢å¾©äº†ï¼`, 'reward-msg');
                } else if (item.effect === 'buff_atk') {
                    player.buffs.attack = { multiplier: item.value, duration: item.duration + 1 };
                    this.logMessage(`ä½ ä½¿ç”¨äº† ${item.name}ï¼Œæ”»æ“ŠåŠ›å¤§å¹…æå‡äº†ï¼`, 'buff-msg');
                } else if (item.effect === 'buff_hp') {
                    if (player.buffs.hp) { // å¦‚æœå·²å­˜åœ¨ï¼Œå…ˆç§»é™¤èˆŠçš„
                         player.maxHp -= player.buffs.hp.value;
                    }
                    player.buffs.hp = { value: item.value, duration: item.duration + 1 };
                    player.maxHp += item.value;
                    player.hp += item.value;
                    this.logMessage(`ä½ ä½¿ç”¨äº† ${item.name}ï¼Œæš«æ™‚æå‡äº†ç”Ÿå‘½ä¸Šé™ï¼`, 'buff-msg');
                }
                this.renderInventory();
            }
        } else if (type === 'flee') {
            if (Math.random() < 0.7) {
                this.logMessage('ä½ æˆåŠŸé€ƒè·‘äº†ã€‚');
                this.player.hp = this.combatState.player.hp;
                this.updatePlayerStats();
                this.combatState = {};
                this.changeView('map-view');
            } else {
                this.logMessage('é€ƒè·‘å¤±æ•—ï¼æ•µäººæŠ“ä½äº†æ©Ÿæœƒï¼', 'combat-msg');
                this.endPlayerTurn();
            }
            return;
        }
        
        this.endPlayerTurn();
    },

    enemyTurn() {
        if(this.combatState.turn !== 'enemy' || !this.combatState.enemy) return;
        const { player, enemy } = this.combatState;
        const damage = Math.max(1, enemy.attack - player.defense);
        player.hp = Math.max(0, player.hp - damage);
        this.logMessage(`${enemy.name} å°ä½ é€ æˆäº† ${damage} é»å‚·å®³ã€‚`, 'combat-msg');

        if (player.hp <= 0) {
            this.endCombat(false);
            return;
        }

        this.combatState.turnCount++;
        this.startPlayerTurn();
    },

    endCombat(isVictory) {
        this.player.hp = Math.min(this.combatState.player.hp, this.player.maxHp);
        
        if (isVictory) {
            const enemyId = this.combatState.enemyId;
            const enemyData = ENEMIES[enemyId];
            
            this.player.gold += enemyData.gold;
            
            this.logMessage(`${enemyData.name} è¢«æ“Šæ•—äº†ï¼ä½ ç²å¾—äº† ${enemyData.gold} é‡‘å¹£ã€‚`, 'reward-msg');
            
            if (enemyData.drops) {
                if (Math.random() < enemyData.drops.common.chance) {
                    const droppedItem = ITEMS[enemyData.drops.common.id];
                    this.player.inventory[enemyData.drops.common.id] = (this.player.inventory[enemyData.drops.common.id] || 0) + 1;
                    this.logMessage(`ä½ ç²å¾—äº† ${droppedItem.name} x1ã€‚`, 'reward-msg');
                }
                if (Math.random() < enemyData.drops.rare.chance) {
                    const droppedItemId = enemyData.drops.rare.id;
                    const droppedItem = ITEMS[droppedItemId];
                    this.player.inventory[droppedItemId] = (this.player.inventory[droppedItemId] || 0) + 1;
                    this.logMessage(`ä½ ç²å¾—äº†ç¨€æœ‰çš„ ${droppedItem.name} x1ï¼`, 'reward-msg');

                    if(droppedItem.type === 'upgrade') {
                        this.usePermanentUpgrade(droppedItemId);
                    }
                }
            }
            
            this.updatePlayerStats();
            this.renderInventory();

            if (enemyData.isBoss) {
                this.player.defeatedBosses.push(enemyId);
                this.renderMap();
                 if (enemyId === 'forest_guardian') {
                     this.advanceStory('s4_mountain_unlocked');
                } else if (enemyId === 'griffin') {
                     this.advanceStory('s5_wasteland_unlocked');
                } else if (enemyId === 'wasteland_tyrant') {
                    this.storyProgress = 's6_peak_unlocked';
                    this.logMessage('ç‡¼ç«ä¹‹å·”çš„é“è·¯ä¼¼ä¹æš¢é€šäº†...', 'story-msg');
                    this.changeView('map-view');
                } else if (enemyId === 'boss') {
                    this.advanceStory('s8_ending');
                }
            } else {
                this.changeView('map-view');
            }
        } else {
            this.logMessage('ä½ è¢«æ“Šæ•—äº†â€¦â€¦éŠæˆ²çµæŸã€‚', 'danger-msg');
            this.changeView('story-view');
            document.getElementById('story-title').textContent = 'æ—…ç¨‹çš„çµ‚é»';
            document.getElementById('story-text').textContent = 'å¦³çš„å†’éšªåˆ°æ­¤ç‚ºæ­¢äº†ã€‚ä½†å¦³çš„å‹‡æ°£å°‡æœƒè¢«æ°¸é éŠ˜è¨˜ã€‚';
            const optionsContainer = document.getElementById('story-options');
            optionsContainer.innerHTML = `<button class="game-button" onclick="game.init()">é‡æ–°é–‹å§‹</button>`;
        }
        
        this.updatePlayerStats();
    }
};

// éŠæˆ²å•Ÿå‹•
game.init();

</script>
</body>
</html>

